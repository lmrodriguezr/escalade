/**
 *  Copyright (c) 2010 Alethia Inc,
 *  http://www.alethia-inc.com
 *  Developed by Travis Tidwell | travist at alethia-inc.com 
 *
 *  License:  GPL version 3.
 *
 *  Permission is hereby granted, free of charge, to any person obtaining a copy
 *  of this software and associated documentation files (the "Software"), to deal
 *  in the Software without restriction, including without limitation the rights
 *  to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 *  copies of the Software, and to permit persons to whom the Software is
 *  furnished to do so, subject to the following conditions:
 *  
 *  The above copyright notice and this permission notice shall be included in
 *  all copies or substantial portions of the Software.

 *  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 *  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 *  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 *  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 *  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 *  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 *  THE SOFTWARE.
 */
(function(a){jQuery.media=jQuery.media?jQuery.media:{};jQuery.media.defaults=jQuery.extend(jQuery.media.defaults,{vertical:true,scrollSpeed:20,updateTimeout:40,hysteresis:40,showScrollbar:true,scrollMode:"auto"});jQuery.media.ids=jQuery.extend(jQuery.media.ids,{listMask:"#medialistmask",list:"#medialist",scrollWrapper:"#mediascrollbarwrapper",scrollBar:"#mediascrollbar",scrollTrack:"#mediascrolltrack",scrollHandle:"#mediascrollhandle",scrollUp:"#mediascrollup",scrollDown:"#mediascrolldown"});jQuery.fn.mediascroll=function(b){return new (function(c,e){e=jQuery.media.utils.getSettings(e);this.display=c;var f=this;this.spanMode=(e.scrollMode=="span");this.listMask=c.find(e.ids.listMask);if(this.spanMode||(e.scrollMode=="auto")){this.listMask.bind("mouseenter",function(g){f.onMouseOver(g);});this.listMask.bind("mouseleave",function(g){f.onMouseOut(g);});this.listMask.bind("mousemove",function(g){f.onMouseMove(g);});}this.listMask.css("overflow","hidden");this.list=c.find(e.ids.list);var d=this.list.children().eq(0);this.elementWidth=d.width();this.elementHeight=d.height();this.elementSize=e.vertical?d.outerHeight(true):d.outerWidth(true);if(jQuery.browser.msie&&parseInt(jQuery.fn.jquery.replace(".",""),10)<132){this.template=a("<div></div>").append(jQuery.media.utils.cloneFix(d)).html();}else{this.template=a("<div></div>").append(d.clone()).html();}this.list.empty();this.pagePos=e.vertical?"pageY":"pageX";this.margin=e.vertical?"marginTop":"marginLeft";this.scrollSize=e.vertical?0:this.listMask.width();this.scrollMid=0;this.mousePos=0;this.listPos=0;this.scrollInterval=0;this.shouldScroll=false;this.bottomPos=0;this.ratio=0;this.elements=[];this.listSize=0;this.scrollBar=c.find(e.ids.scrollTrack).mediaslider(e.ids.scrollHandle,e.vertical);this.scrollUp=c.find(e.ids.scrollUp).medialink(e,function(){f.scroll(true);});this.scrollDown=c.find(e.ids.scrollDown).medialink(e,function(){f.scroll(false);});if(this.scrollBar){this.scrollBar.display.bind("updatevalue",function(g,h){f.setScrollPos(h*f.bottomPos,false);});this.scrollBar.display.bind("setvalue",function(g,h){f.setScrollPos(h*f.bottomPos,true);});}this.setScrollSize=function(g){if(g){this.scrollSize=g;this.listMask.css(e.vertical?"height":"width",this.scrollSize);this.scrollMid=this.scrollSize/2;var h=this.scrollSize-(e.hysteresis*2);this.bottomPos=(this.listSize-this.scrollSize);this.ratio=((this.listSize-h)/h);this.shouldScroll=(this.bottomPos>0);}};this.clear=function(){this.mousePos=0;this.shouldScroll=false;this.bottomPos=0;this.ratio=0;this.scrolling=false;this.elements=[];this.listSize=0;this.list.css(this.margin,0);this.list.children().unbind();clearInterval(this.scrollInterval);this.list.empty();};this.getOffset=function(){return e.vertical?this.listMask.offset().top:this.listMask.offset().left;};this.activate=function(){this.setScrollSize(e.vertical?this.listMask.height():this.listMask.width());this.setScrollPos(0,true);};this.refresh=function(){this.setScrollSize(this.scrollSize);};this.newItem=function(){var h=a(this.template);this.list.append(h);var g=this.getElement(h,this.elements.length);this.listSize+=g.size;if(e.vertical){this.list.css({height:this.listSize});}else{this.list.css({width:this.listSize});}this.elements.push(g);return g.obj;};this.getElement=function(i,g){var h=this.elementSize;var j=this.listSize;return{obj:i,size:h,position:j,bottom:(j+h),mid:(h/2),index:g};};this.scroll=function(g){var h=this.getElementAtPosition(g?0:this.scrollSize);if(h){var j=(h.straddle||g)?h:this.elements[h.index+1];if(j){var i=g?j.position:(j.bottom-this.scrollSize);this.setScrollPos(i,true);}}};this.onMouseMove=function(g){this.mousePos=g[this.pagePos]-this.getOffset();if(this.shouldScroll&&this.spanMode){this.setScrollPos((this.mousePos-e.hysteresis)*this.ratio);}};this.onMouseOver=function(g){if(this.shouldScroll){clearInterval(this.scrollInterval);this.scrollInterval=setInterval(function(){f.update();},e.updateTimeout);}};this.onMouseOut=function(g){clearInterval(this.scrollInterval);};this.align=function(g){var h=this.getElementAtPosition(g?0:this.scrollSize);if(h){var i=g?h.position:(h.bottom-this.scrollSize);this.setScrollPos(i,true);}};this.setVisible=function(g){var i=this.elements[g];if(i){var h=this.listPos;if(i.position<this.listPos){h=i.position;}else{if((i.bottom-this.listPos)>this.scrollSize){h=i.bottom-this.scrollSize;}}if(h!=this.listPos){this.setScrollPos(h,true);}}};this.getElementAtPosition=function(g){var j=null;var h=this.elements.length;while(h--){j=this.elements[h];if(((j.position-this.listPos)<g)&&((j.bottom-this.listPos)>=g)){j.straddle=((j.bottom-this.listPos)!=g);break;}}return j;};this.update=function(){var h=this.mousePos-this.scrollMid;if(Math.abs(h)>e.hysteresis){var g=(h>0)?-e.hysteresis:e.hysteresis;h=e.scrollSpeed*((this.mousePos+g-this.scrollMid)/this.scrollMid);this.setScrollPos(this.listPos+h);}};this.setScrollPos=function(h,g){h=(h<0)?0:h;if(this.shouldScroll&&(h>this.bottomPos)){h=this.bottomPos;}this.listPos=h;if(this.scrollBar){this.scrollBar.setPosition(this.listPos/this.bottomPos);}if(g){if(e.vertical){this.list.animate({marginTop:-this.listPos},(e.scrollSpeed*10));}else{this.list.animate({marginLeft:-this.listPos},(e.scrollSpeed*10));}}else{this.list.css(this.margin,-this.listPos);}};})(this,b);};})(jQuery);